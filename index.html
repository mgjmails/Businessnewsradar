<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Business News Radar</title>
  <style>
    body{margin:0;font-family:Arial,Helvetica,sans-serif;background:#f3f6fb;color:#0f172a}
    .wrap{max-width:1100px;margin:0 auto;padding:20px}
    h1{text-align:center;font-size:48px;margin:10px 0;font-weight:900}
    .sub{text-align:center;color:#64748b;margin:0 0 20px}
    #banner{display:none;text-align:center;padding:10px;background:#eef2ff;border:1px solid #c7d2fe;margin:0 auto 15px;max-width:800px;border-radius:10px}
    #banner.show{display:block}
    .grid{display:grid;grid-template-columns:1fr;gap:14px}
    @media(min-width:700px){.grid{grid-template-columns:1fr 1fr}}
    .card{display:flex;gap:12px;background:#fff;padding:14px;border-radius:12px;box-shadow:0 4px 10px rgba(0,0,0,0.08)}
    .thumb{width:90px;height:90px;object-fit:cover;border-radius:8px;background:#ddd}
    .title{margin:0;font-size:17px;font-weight:700}
    .summary{font-size:14px;color:#374151;margin:4px 0 8px}
    .meta{font-size:12px;color:#555;display:flex;justify-content:space-between;align-items:center}
    .badge{background:#e0e7ff;padding:3px 8px;border-radius:12px;font-size:11px;font-weight:700}
    .wa{background:#25D366;color:#fff;border-radius:50%;width:28px;height:28px;display:flex;align-items:center;justify-content:center;text-decoration:none}
    .last{text-align:center;font-size:12px;color:#666;margin-top:12px}
  </style>
</head>
<body>
  <div class="wrap">
    <h1>Business News Radar</h1>
    <p class="sub">Latest updates from 30+ business & finance portals worldwide</p>

    <div id="banner"><strong>Please wait.</strong> Fetching the latest news…</div>

    <h2 style="font-size:18px;margin-top:10px">Today’s Top Stories</h2>
    <div id="newsToday" class="grid"></div>

    <h2 style="font-size:18px;margin-top:20px">News we shared Yesterday</h2>
    <div id="newsYesterday" class="grid"></div>

    <p id="last" class="last"></p>
  </div>

  <script>
    // Expand with more sources (India + Global)
    const SOURCES = [
      { name:'Economic Times', url:'https://economictimes.indiatimes.com/markets/rssfeeds/1977021501.cms' },
      { name:'Moneycontrol', url:'https://www.moneycontrol.com/rss/latestnews.xml' },
      { name:'LiveMint', url:'https://www.livemint.com/rss/market/stock-market-news/rssfeed.xml' },
      { name:'Business Standard', url:'https://www.business-standard.com/rss/home-page-top-stories.rss' },
      { name:'Business Today', url:'https://www.businesstoday.in/rssfeeds/?id=211' },
      { name:'Financial Express', url:'https://www.financialexpress.com/market/feed/' },
      { name:'Forbes India', url:'https://www.forbesindia.com/rssfeed/rss.xml' },
      { name:'VCCircle', url:'https://www.vccircle.com/rss/feed' },
      { name:'Pulse by Zerodha', url:'https://pulse.zerodha.com/feed/' },
      { name:'TradingView India', url:'https://in.tradingview.com/news/rss/' },
      { name:'Bloomberg', url:'https://www.bloomberg.com/feed/podcast/etf-report.xml' },
      { name:'Reuters Business', url:'https://feeds.reuters.com/reuters/businessNews' },
      { name:'Financial Times', url:'https://www.ft.com/?format=rss' },
      { name:'CNBC', url:'https://www.cnbc.com/id/100003114/device/rss/rss.html' },
      { name:'MarketWatch', url:'https://www.marketwatch.com/rss/topstories' },
      { name:'Wall Street Journal', url:'https://feeds.a.dj.com/rss/RSSMarketsMain.xml' },
      { name:'Yahoo Finance', url:'https://feeds.finance.yahoo.com/rss/2.0/headline?s=&region=US&lang=en-US' },
      { name:'Investing.com', url:'https://www.investing.com/rss/news.rss' },
      { name:'Seeking Alpha', url:'https://seekingalpha.com/market_currents.xml' },
      { name:'Business Insider', url:'https://www.businessinsider.com/rss' },
      { name:'The Hindu BusinessLine', url:'https://www.thehindubusinessline.com/feeder/default.rss' },
      { name:'NDTV Profit', url:'https://feeds.feedburner.com/ndtvprofit-latest' },
      { name:'Global Times Business', url:'https://www.globaltimes.cn/rss/business.xml' },
      { name:'The Guardian Business', url:'https://www.theguardian.com/uk/business/rss' },
      { name:'New York Times Business', url:'https://rss.nytimes.com/services/xml/rss/nyt/Business.xml' },
      { name:'BBC Business', url:'http://feeds.bbci.co.uk/news/business/rss.xml' },
      { name:'Fortune', url:'https://fortune.com/feed/' },
      { name:'Nikkei Asia', url:'https://asia.nikkei.com/rss' },
      { name:'The Economist', url:'https://www.economist.com/business/rss.xml' },
      { name:'Morningstar', url:'https://www.morningstar.com/rss' }
    ];

    const todayEl = document.getElementById('newsToday');
    const yesterdayEl = document.getElementById('newsYesterday');

    function esc(s){const d=document.createElement('div');d.textContent=s||'';return d.innerHTML;}
    function textOnly(html){return (html||'').replace(/<[^>]+>/g,' ').replace(/\s+/g,' ').trim();}
    function firstTagAttr(node, tag, attr){const el=node.getElementsByTagName(tag)[0];return el?(el.getAttribute(attr)||''):'';}

    function parseFeed(xmlText, source){
      if(!xmlText) return [];
      const p=new DOMParser();
      const doc=p.parseFromString(xmlText,'text/xml');
      let nodes=Array.from(doc.getElementsByTagName('item'));
      if(!nodes.length) nodes=Array.from(doc.getElementsByTagName('entry'));
      return nodes.slice(0,40).map(n=>{
        const t=n.getElementsByTagName('title')[0]?.textContent?.trim()||'Untitled';
        let link=n.getElementsByTagName('link')[0]?.textContent?.trim()||'#';
        const linkHref=n.getElementsByTagName('link')[0]?.getAttribute('href');
        if((!link||link==="#")&&linkHref) link=linkHref;
        const raw=n.getElementsByTagName('description')[0]?.textContent||'';
        const desc=textOnly(raw);
        const pub=n.getElementsByTagName('pubDate')[0]?.textContent||'';
        const ts=pub?Date.parse(pub):Date.now();
        const img=firstTagAttr(n,'media:content','url')||firstTagAttr(n,'media:thumbnail','url')||firstTagAttr(n,'enclosure','url')||'';
        return {title:t,link,desc,ts,source,img};
      });
    }

    function categorize(title,desc){
      const s=(title+" "+desc).toLowerCase();
      if(/ipo|nse|bse|share|stock|sensex|nifty|results|q[1-4]/.test(s)) return 'Stocks';
      if(/funding|acquisition|merger|deal|private equity|vc/.test(s)) return 'Industry';
      if(/budget|rbi|inflation|gdp|economy|policy/.test(s)) return 'Economy';
      if(/ai|tech|software|it|semiconductor/.test(s)) return 'AI/Tech';
      return 'Business';
    }

    function fmtDate(ts){try{return new Date(ts).toLocaleString();}catch{return'';}}
    function siteIcon(u){try{const host=new URL(u).hostname;return`https://www.google.com/s2/favicons?domain=${host}&sz=128`;}catch{return'https://via.placeholder.com/90x90?text=News';}}

    function cardHTML(n){
      const cat=categorize(n.title,n.desc);
      const img=(n.img&&n.img.startsWith('http'))?n.img:siteIcon(n.link);
      const wa=`https://api.whatsapp.com/send?text=${encodeURIComponent(n.title+' '+n.link)}`;
      return `<div class='card'>
        <img class='thumb' src='${img}' onerror="this.src='${siteIcon(n.link)}'"/>
        <div style='flex:1'>
          <p class='title'>${esc(n.title)}</p>
          <p class='summary'>${esc(n.desc).slice(0,180)}…</p>
          <div class='meta'>
            <span><span class='badge'>${cat}</span> ${esc(n.source)} • ${fmtDate(n.ts)}</span>
            <a class='wa' href='${wa}' target='_blank'>↗</a>
          </div>
        </div>
      </div>`;
    }

    function startOfToday(){const d=new Date();d.setHours(0,0,0,0);return d.getTime();}
    function startOfYesterday(){const d=new Date();d.setHours(0,0,0,0);d.setDate(d.getDate()-1);return d.getTime();}

    async function load(){
      document.getElementById('banner').classList.add('show');
      todayEl.innerHTML=yesterdayEl.innerHTML='';

      const results=await Promise.allSettled(SOURCES.map(s=>fetch(s.url).then(r=>r.text()).then(txt=>({txt,s})).catch(()=>({txt:null,s}))));
      let items=[];
      for(const r of results){if(r.value&&r.value.txt){items.push(...parseFeed(r.value.txt,r.value.s.name));}}

      const t0=startOfToday();
      const y0=startOfYesterday();
      const todayItems=items.filter(it=>it.ts>=t0);
      const yesterdayItems=items.filter(it=>it.ts>=y0&&it.ts<t0);

      todayItems.sort((a,b)=>b.ts-a.ts);
      yesterdayItems.sort((a,b)=>b.ts-a.ts);

      todayEl.innerHTML=todayItems.map(cardHTML).join('')||'<p class="sub">No news today.</p>';
      yesterdayEl.innerHTML=yesterdayItems.map(cardHTML).join('')||'<p class="sub">No news yesterday.</p>';

      document.getElementById('last').textContent='Last updated: '+new Date().toLocaleString();
      document.getElementById('banner').classList.remove('show');
    }

    load();
    setInterval(load,120000);
  </script>
</body>
</html>
